{% extends 'users/base.html' %}
{% load static %}

{% block content %}
<style>
    .car-img {
        height: 100%;
        width: 100%;
        object-fit: cover;
        border-radius: 0.5rem 0 0 0.5rem;
    }

    .card {
        border: 1px solid #e0e0e0;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease-in-out;
        border-radius: 0.5rem;
    }

    .card:hover {
        transform: scale(1.01);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
    }

    .card-body h5 {
        font-weight: 600;
        font-size: 1.25rem;
    }
    
    .modal-title {
        font-weight: 600;
        font-size: 1.2rem;
    }
   

    .modal-footer button {
        min-width: 100px;
    }

    .text-center {
        text-align: center;
    }

    .btn-sm {
        min-width: 90px;
    }

    .empty-state {
        font-size: 1.2rem;
        color: #6c757d;
        margin-top: 2rem;
    }
    .dark-mode #edit-form-title{
      color: #ffffff !important;
    }
    .dark-mode .modal-header h5{
      color: #ffffff !important;
    }
    .dark-mode .modal-content {
      background-color: #121212 !important;
    }
</style>

<div class="container mt-5">
    <h1 class="text-center mb-4">Hello, {{user.first_name}} {{user.last_name}} </h1>

    <h2 class="text-center mb-4">Your Uploaded Cars</h2>

    {% if cars %}
        <div class="row g-4">
            {% for car in cars %}
                <div class="col-md-12">
                    <div class="card">
                        <div class="row g-0">
                            <div class="col-md-4">
                                {% if car.image %}
                                    <img src="{{ car.image.url }}" class="car-img" alt="{{ car.title }}">
                                {% else %}
                                    <img src="{% static 'default-car.jpg' %}" class="car-img" alt="No image">
                                {% endif %}
                            </div>
                            <div class="col-md-8">
                                <div class="card-body">
                                    <h5 class="card-title">{{ car.title }}</h5>
                                    <p class="card-text">{{ car.description|truncatechars:150 }}</p>
                                    <p class="card-text mb-1"><strong>Price:</strong> ${{ car.price }}</p>
                                    <p class="card-text mb-2"><strong>Year:</strong> {{ car.year }}</p>
                                    <div>
                                        <button class="btn btn-outline-primary btn-sm me-2" data-bs-toggle="modal" data-bs-target="#editModal{{ car.id }}">Edit</button>
                                        <button class="btn btn-outline-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal{{ car.id }}">Delete</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Edit Modal -->
                <div class="modal fade" id="editModal{{ car.id }}" tabindex="-1" aria-labelledby="editModalLabel{{ car.id }}" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <form method="POST" action="{% url 'edit_car' car.id %}" enctype="multipart/form-data">
                                {% csrf_token %}
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editModalLabel{{ car.id }}">Edit Car</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="mb-3">
                                        <label class="form-label" id="edit-form-title">Title</label>
                                        <input type="text" class="form-control" name="title" value="{{ car.title }}" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label"  id="edit-form-title">Description</label>
                                        <textarea class="form-control" name="description" rows="3" required>{{ car.description }}</textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label"  id="edit-form-title">Price</label>
                                        <input type="number" class="form-control" name="price" value="{{ car.price }}" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label"  id="edit-form-title">Year</label>
                                        <input type="number" class="form-control" name="year" value="{{ car.year }}" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label"  id="edit-form-title">Image</label>
                                        <input type="file" class="form-control" name="image">
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Delete Modal -->
                <div class="modal fade" id="deleteModal{{ car.id }}" tabindex="-1" aria-labelledby="deleteModalLabel{{ car.id }}" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <form method="POST" action="{% url 'delete_car' car.id %}">
                                {% csrf_token %}
                                <div class="modal-header">
                                    <h5 class="modal-title" id="deleteModalLabel{{ car.id }}">Confirm Deletion</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    Are you sure you want to delete <strong>"{{ car.title }}"</strong>?
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-danger">Delete</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-center empty-state">You haven't uploaded any cars yet.</p>
    {% endif %}

    <div>
        <h2 class="text-center mb-4">Reset Password</h2>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
